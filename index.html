<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Registro de Datos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    input, textarea, button {
      display: block;
      margin-bottom: 10px;
      width: 100%;
      padding: 8px;
    }
    #estado {
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h2>Formulario de Registro</h2>

  <input type="text" id="nombre" placeholder="Nombre del Técnico" required />
  <input type="text" id="d1" placeholder="Dato D1" />
  <input type="text" id="d2" placeholder="Dato D2" />
  <input type="text" id="d3" placeholder="Dato D3" />
  <textarea id="observaciones" placeholder="Observaciones"></textarea>

  <button onclick="enviarDatos()">Enviar Datos</button>

  <div id="estado"></div>

  <script>
    function enviarDatos() {
      const estado = document.getElementById("estado");
      estado.textContent = "Enviando...";

      const formData = new FormData();
      formData.append("action", "RegDat");
      formData.append("nombre", document.getElementById("nombre").value);
      formData.append("d1", document.getElementById("d1").value);
      formData.append("d2", document.getElementById("d2").value);
      formData.append("d3", document.getElementById("d3").value);
      formData.append("observaciones", document.getElementById("observaciones").value);

      const controller = new AbortController();
      const timeout = setTimeout(() => {
        controller.abort();
        estado.textContent = "Error: tiempo de espera superado (más de 40 segundos).";
      }, 40000); // 40 segundos

      fetch("https://script.google.com/macros/s/AKfycbytv09AEmvj2bmLtCasurOcvNmaaXyfaQM5C-wMIiVgNgWfBSIysZ7mR5e4FtGSxq5v0Q/exec", {
        method: "POST",
        body: formData,
        signal: controller.signal
      })
      .then(response => response.text())
      .then(text => {
        clearTimeout(timeout);
        if (text.trim() === "Success") {
          estado.textContent = "Datos enviados correctamente.";
        } else {
          estado.textContent = "Error en la respuesta: " + text;
        }
      })
      .catch(error => {
        clearTimeout(timeout);
        if (error.name === 'AbortError') {
          estado.textContent = "Error: la solicitud fue cancelada por tiempo.";
        } else {
          console.error(error);
          estado.textContent = "Error al enviar los datos.";
        }
      });
    }
  </script>

</body>
</html>
